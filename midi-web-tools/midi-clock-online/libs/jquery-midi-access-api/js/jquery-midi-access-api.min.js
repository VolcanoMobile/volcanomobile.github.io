/* Copyright (C) Volcanomobile, Inc - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Volcanomobile <contact@volcanomobile.net>, January 2020
 */ 
 
var jMidiAccessApi=function(t){var i={midiSupported:!1,midiAccess:null,outputPorts:[],initCallback:null,deviceStateChangeCallback:null,portDisconnectedCallback:null,portConnectedCallback:null,receiveCallback:null,sendCallback:null,logLevel:jMidiAccessApi.LOG_LEVEL_ERROR},e=this,s=[];this.construct=function(t){$.extend(i,t),this.initMidi()},this.initMidi=function(t){i.logLevel>=jMidiAccessApi.LOG_LEVEL_DEBUG&&console.log("jMidiAccessApi - Init MIDI"),navigator.requestMIDIAccess?(i.logLevel>=jMidiAccessApi.LOG_LEVEL_DEBUG&&console.log("jMidiAccessApi - MIDI supported"),i.midiSupported=!0,navigator.requestMIDIAccess().then(this.requestMIDIAccessSuccess,this.requestMIDIAccessFailure)):(i.logLevel>=jMidiAccessApi.LOG_LEVEL_DEBUG&&console.log("jMidiAccessApi - initMidi() MIDI not supported"),i.initCallback(i))},this.requestMIDIAccessSuccess=function(t){for(var c of(i.logLevel>=jMidiAccessApi.LOG_LEVEL_DEBUG&&console.log("jMidiAccessApi - Request MIDI Access Success"),i.midiAccess=t,i.midiAccess.onstatechange=function(t){i.logLevel>=jMidiAccessApi.LOG_LEVEL_DEBUG&&console.log("jMidiAccessApi - State Change"),e.addAllOutputPorts(),i.deviceStateChangeCallback(t.port,i)},i.midiAccess.inputs.values()))s.push(c);e.initOutputPorts(),i.initCallback(i)},this.requestMIDIAccessFailure=function(t){i.logLevel>=jMidiAccessApi.LOG_LEVEL_DEBUG&&console.log("jMidiAccessApi - requestMIDIAccessFailure()"),i.initCallback(i)},this.bindInputPort=function(t){i.logLevel>=jMidiAccessApi.LOG_LEVEL_DEBUG&&console.log("jMidiAccessApi - Bind Input Port: "+t.name),t&&null==t.onmidimessage&&(t.onmidimessage=this.receive,i.portConnectedCallback(t,i))},this.bindInputPortByName=function(t){var e=null;for(var s of i.midiAccess.inputs.values())s.name==t&&(e=s);this.bindInputPort(e)},this.unbindInputPort=function(t,e){i.logLevel>=jMidiAccessApi.LOG_LEVEL_DEBUG&&console.log("jMidiAccessApi - Unbind Input Port: "+e.name),e&&null!=e.onmidimessage&&(e.onmidimessage=null,i.portDisconnectedCallback(e,i))},this.unbindInputPortByName=function(t){var e=null,s=null;for(var c of i.midiAccess.inputs)for(var n of c.values())n.name==t&&(e=c,s=n);this.unbindInputPort(e,s)},this.initOutputPorts=function(){i.logLevel>=jMidiAccessApi.LOG_LEVEL_ALL&&console.log("jMidiAccessApi - initOutputPorts()"),this.addAllOutputPorts()},this.addAllOutputPorts=function(){for(var t of(i.logLevel>=jMidiAccessApi.LOG_LEVEL_ALL&&console.log("jMidiAccessApi - addAllOutputPorts()"),i.midiAccess.outputs.values()))this.addOutputPort(t)},this.addOutputPort=function(t){i.logLevel>=jMidiAccessApi.LOG_LEVEL_DEBUG&&console.log("jMidiAccessApi - Add OUTPUT port: "+t.name),this.outputPortExists(t)||i.outputPorts.push(new jMidiAccessApiPort({id:t.id,name:t.name,type:"output",connected:!1}))},this.getOutputPortIndexById=function(t){for(var e=0;e<i.outputPorts.length;e++){if(i.outputPorts[e].getId()==outputPort.id)return e}return-1},this.isOutputConnectedById=function(t){for(var e of i.outputPorts)if(e.getId()==t&&e.isConnected())return!0;return!1},this.outputPortExists=function(t){for(var e of i.outputPorts)if(e.getId()==t.id)return!0;return!1},this.connectOutputPortByName=function(t){i.logLevel>=jMidiAccessApi.LOG_LEVEL_DEBUG&&console.log("jMidiAccessApi - Connect OUTPUT port by name: "+t);for(var e=0;e<i.outputPorts.length;e++){var s=i.outputPorts[e];if(s.getName()==t)return i.outputPorts[e].setConnected(!0),i.portConnectedCallback(s,i),!0}return!1},this.disconnectOutputPortByName=function(t){i.logLevel>=jMidiAccessApi.LOG_LEVEL_DEBUG&&console.log("jMidiAccessApi - Disconnect OUTPUT port by name: "+t);for(var e=0;e<i.outputPorts.length;e++){var s=i.outputPorts[e];if(s.getName()==t)return i.outputPorts[e].setConnected(!1),i.portDisconnectedCallback(s,i),!0}return!1},this.receive=function(t){i.logLevel>=jMidiAccessApi.LOG_LEVEL_ALL&&console.log("jMidiAccessApi - Receive MIDIMessageEvent: ",t.data),i.receiveCallback(t)},this.send=function(t){i.logLevel>=jMidiAccessApi.LOG_LEVEL_ALL&&console.log("jMidiAccessApi - Send MIDIMessageEvent: ",t.data);const e=i.midiAccess.outputs.values();for(var s of e)this.isOutputConnectedById(s.id)&&s.send(t.data)},this.construct(t)},jMidiAccessApiPort=function(t){var i={id:!1,name:null,type:!1,connected:!1};this.construct=function(t){$.extend(i,t)},this.getId=function(){return i.id},this.getName=function(){return i.name},this.isConnected=function(){return i.connected},this.setConnected=function(t){i.connected=t},this.construct(t)};jMidiAccessApi.LOG_LEVEL_ERROR=0,jMidiAccessApi.LOG_LEVEL_INFO=1,jMidiAccessApi.LOG_LEVEL_WARNING=2,jMidiAccessApi.LOG_LEVEL_DEBUG=3,jMidiAccessApi.LOG_LEVEL_ALL=4;