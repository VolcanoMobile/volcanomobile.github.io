/* Copyright (C) Volcanomobile, Inc - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Volcanomobile <contact@volcanomobile.net>, January 2020
 */ 

var jMidiClock=function(t){var n={numerator:4,denominator:4,numberOfBars:2,division:16,patternLenghtInTick:0,barLenghtInTick:0,beatLenghtInTick:0,divisionLenghtInTick:0,started:!1,slaveMode:!1,startTempo:!0,startTempoPlaying:!1,patternClockCpt:0,barClockCpt:0,beatClockCpt:0,divisionClockCpt:0,onInit:null,onStartTempo:null,onStart:null,onContinue:null,onStop:null,onStartTempoClock:null,onClock:null,onTimeSignatureChange:null,onNumberOfBarsChange:null,onDivisionChange:null};this.construct=function(t){$.extend(n,t),this.refreshLenghtInTick(),n.onInit&&n.onInit(n)},this.refreshLenghtInTick=function(){n.beatLenghtInTick=96/n.denominator,n.barLenghtInTick=n.beatLenghtInTick*n.numerator,n.patternLenghtInTick=n.barLenghtInTick*n.numberOfBars,n.divisionLenghtInTick=96/n.division},this.clock=function(){n.started&&(n.startTempoPlaying?(n.onStartTempoClock&&n.onStartTempoClock(n),n.patternClockCpt=n.patternClockCpt+1,n.patternClockCpt==n.barLenghtInTick&&(n.startTempoPlaying=!1,n.patternClockCpt=0,n.onStart&&n.onStart())):(n.onClock&&n.onClock(n),n.patternClockCpt=(n.patternClockCpt+1)%n.patternLenghtInTick),n.barClockCpt=n.patternClockCpt%n.barLenghtInTick,n.beatClockCpt=n.barClockCpt%n.beatLenghtInTick,n.divisionClockCpt=n.barClockCpt%n.divisionLenghtInTick)},this.start=function(t){n.started||(n.patternClockCpt=0,n.barClockCpt=0,n.beatClockCpt=0,n.started=!0,n.slaveMode=t,n.slaveMode&&this.setStartTempo(!1),n.startTempo?(n.startTempoPlaying=!0,n.onStartTempo&&n.onStartTempo()):n.onStart&&n.onStart(t))},this.continue_=function(){n.started||(n.started=!0,n.onContinue())},this.stop=function(){n.started&&(n.started=!1,n.onStop&&n.onStop())},this.isStarted=function(){return n.started},this.getDenominator=function(){return n.denominator},this.setDenominator=function(t){n.denominator=t,this.refreshLenghtInTick(),n.onTimeSignatureChange&&n.onTimeSignatureChange(n.numerator,n.denominator)},this.getNumerator=function(){return n.numerator},this.setNumerator=function(t){n.numerator=t,this.refreshLenghtInTick(),n.onTimeSignatureChange&&n.onTimeSignatureChange(n.numerator,n.denominator)},this.getNumberOfBars=function(){return n.numberOfBars},this.setNumberOfBars=function(t){n.numberOfBars=t,this.refreshLenghtInTick(),n.onNumberOfBarsChange&&n.onNumberOfBarsChange(n.numberOfBars)},this.getDivision=function(){return n.division},this.setDivision=function(t){n.division=t,this.refreshLenghtInTick(),n.onDivisionChange&&n.onDivisionChange(n.division)},this.getStartTempo=function(){return n.startTempo},this.setStartTempo=function(t){n.startTempo=t},this.construct(t)};