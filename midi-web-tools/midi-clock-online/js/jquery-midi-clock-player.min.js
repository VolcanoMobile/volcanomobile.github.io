/* Copyright (C) Volcanomobile, Inc - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 * Written by Volcanomobile <contact@volcanomobile.net>, January 2020
 */ 
 
var jMidiClockPlayer=function(t){var i={loopDelayMilli:9,bpm:60,tickMilli:0,lastTimeMilli:0,delayMilli:0,started:!1,slaveMode:!1,clockCpt:0,onInit:null,onStart:null,onContinue:null,onStop:null,onClock:null,onBpmChange:null},l=this;this.construct=function(t){$.extend(i,t),i.tickMilli=6e4/i.bpm/24,i.onInit&&i.onInit(i)},this.start=function(t){if(!i.started){i.clockCpt=0,i.started=!0,i.slaveMode=t,i.onStart(t);var l=new Date;i.lastTimeMilli=l.getTime(),i.slaveMode||this.loop()}},this.continue_=function(t){if(!i.started){i.started=!0,i.onContinue&&i.onContinue();var l=new Date;i.lastTimeMilli=l.getTime(),this.loop()}},this.stop=function(t){i.started&&(i.started=!1,i.onStop())},this.loop=function(){if(i.started){for(;i.delayMilli>=0;)l.clock(!1),i.clockCpt++,i.delayMilli-=i.tickMilli;var t=new Date;i.delayMilli+=t.getTime()-i.lastTimeMilli,i.lastTimeMilli=t.getTime(),setTimeout(l.loop,i.loopDelayMilli)}},this.clock=function(t){i.onClock&&i.onClock(i.clockCpt)},this.setBpm=function(t){t>=10&&(i.bpm=t,i.tickMilli=6e4/i.bpm/24,i.onBpmChange&&i.onBpmChange(i.bpm))},this.getBpm=function(){return i.bpm},this.construct(t)};