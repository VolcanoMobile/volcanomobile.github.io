var myMidiClock;var myMidiClockPlayer;var myMidiAccessApi;jQuery(document).ready(function(){myMidiClock=new jMidiClock({onInit:function(a){refreshTimeSignatureInfo(a.numerator,a.denominator);
refreshNumberOfBarInfo(a.numberOfBars);refreshDivisionInfo(a.division);$("#numeratorSelect").val(a.numerator);
$("#denominatorSelect").val(a.denominator);$("#numberOfBarSelect").val(a.numberOfBars);
$("#divisionSelect").val(a.division)},onStartTempo:function(){jQuery("#buttonStart").prop("disabled",true);
jQuery("#buttonContinue").prop("disabled",true);jQuery("#buttonStop").prop("disabled",false)
},onStartTempoClock:function(b){if(b.patternClockCpt%b.beatLenghtInTick==0){myMidiAccessApi.send({receivedTime:window.performance.now(),data:[153,34,100]});
jQuery("#startTempoLight").fadeIn(0).fadeOut(200,function(){});var a=((b.patternClockCpt+b.beatLenghtInTick)*100/b.barLenghtInTick);
$("#measureProgressBar").css("width",a+"%").attr("aria-valuenow",a)}},onStart:function(a){myMidiAccessApi.send({receivedTime:window.performance.now(),data:[250]});
jQuery("#buttonStart").prop("disabled",true);jQuery("#buttonContinue").prop("disabled",true);
jQuery("#buttonStop").prop("disabled",false)},onContinue:function(){myMidiAccessApi.send({receivedTime:window.performance.now(),data:[251]});
jQuery("#buttonStart").prop("disabled",true);jQuery("#buttonContinue").prop("disabled",true);
jQuery("#buttonStop").prop("disabled",false)},onStop:function(){myMidiAccessApi.send({receivedTime:window.performance.now(),data:[252]});
jQuery("#buttonStart").prop("disabled",false);jQuery("#buttonContinue").prop("disabled",false);
jQuery("#buttonStop").prop("disabled",true)},onClock:function(b){$("#patternClockCounter").html(b.patternClockCpt+"/"+b.patternLenghtInTick);
$("#barClockCounter").html(b.barClockCpt+"/"+b.barLenghtInTick);$("#beatClockCounter").html(b.beatClockCpt+"/"+b.beatLenghtInTick);
$("#divisionClockCounter").html(b.divisionClockCpt+"/"+b.divisionLenghtInTick);myMidiAccessApi.send({receivedTime:window.performance.now(),data:[248]});
var a=(b.patternClockCpt*100/b.patternLenghtInTick);$("#measureProgressBar").css("width",a+"%").attr("aria-valuenow",a);
if(b.beatClockCpt==0){if(jQuery("#metronomeCheckbox").is(":checked")){myMidiAccessApi.send({receivedTime:window.performance.now(),data:[153,36,100]})
}jQuery("#beatLight").fadeIn(0).fadeOut(40,function(){})}if(b.divisionClockCpt==0){if(jQuery("#divisionCheckbox").is(":checked")){myMidiAccessApi.send({receivedTime:window.performance.now(),data:[153,42,100]})
}jQuery("#divisionLight").fadeIn(0).fadeOut(40,function(){})}if(b.patternClockCpt==0){myMidiClock.setDenominator($("#denominatorSelect").val());
myMidiClock.setNumerator($("#numeratorSelect").val());myMidiClock.setNumberOfBars($("#numberOfBarSelect").val());
myMidiClock.setDivision($("#divisionSelect").val())}},onTimeSignatureChange:function(a,b){refreshTimeSignatureInfo(a,b)
},onNumberOfBarsChange:function(a){refreshNumberOfBarInfo(a)},onDivisionChange:function(a){refreshDivisionInfo(a)
}});myMidiClockPlayer=new jMidiClockPlayer({onInit:function(a){refreshBpmInfo(a.bpm)
},onClock:function(a){myMidiClock.clock()},onStart:function(a){myMidiClock.start(a)
},onContinue:function(a){myMidiClock.continue_()},onStop:function(a){myMidiClock.stop()
},onBpmChange:function(a){refreshBpmInfo(a)}});myMidiAccessApi=new jMidiAccessApi({initCallback:function(a){jQuery("#midiNotSupported").css("display",a.midiSupported?"none":"block");
if(a.midiSupported){devicesChanged(a)}},onRequestMidiAccessSuccess:function(a){if(a.midiSupported){if(a.midiAccess!=null&&a.midiAccess.outputs!=null){if(typeof a.midiAccess.outputs[Symbol.iterator]==="function"){a.midiAccess.outputs.forEach(function(c,b){myMidiAccessApi.connectOutputPortByName(c.name)
})}}devicesChanged(a)}},onRequestMIDIAccessFailure:function(){jQuery("#requestMIDIAccessFailure").css("display","inline-block");
jQuery("#requestMIDIAccessFailure").delay(3000).fadeOut()},deviceStateChangeCallback:function(a,b){devicesChanged(b)
},portConnectedCallback:function(a,b){devicesChanged(b)},portDisconnectedCallback:function(a,b){devicesChanged(b)
},receiveCallback:function(b){var a=MIDIMessageEventParser.parseEvent(b);for(eventIndex in a){var c=a[eventIndex];
if(c.type=="clock"){myMidiClockPlayer.clock(true)}else{if(c.type=="start"){myMidiClockPlayer.start(true)
}else{if(c.type=="continue"){myMidiClockPlayer.continue_(true)}else{if(c.type=="stop"){myMidiClockPlayer.stop(true)
}else{myMidiAccessApi.send(b)}}}}}}});jQuery("#buttonStart").click(function(){myMidiClockPlayer.start()
});jQuery("#buttonContinue").click(function(){myMidiClockPlayer.continue_()});jQuery("#buttonStop").click(function(){myMidiClockPlayer.stop()
});$("#divisionSelect").on("change",function(){myMidiClock.setDivision($(this).val())
});jQuery("#bpmRange").on("input",function(){jQuery(this).trigger("change")});jQuery("#bpmRange").change(function(){myMidiClockPlayer.setBpm(jQuery(this).val()*2)
});jQuery("#startTempoCheckbox").change(function(){myMidiClock.setStartTempo(this.checked)
});jQuery("#infoButton").click(function(){jQuery("#infoPanel").slideToggle()});jQuery("#showInfoPanelButton").click(function(){jQuery("#infoPanel").slideToggle()
});jQuery("#hideInfoPanelButton").click(function(){jQuery("#infoPanel").slideToggle()
});jQuery("#midiPanelButton").click(function(){jQuery("#midiPanel").slideToggle()
});jQuery("#hideMidiPanelButton").click(function(){jQuery("#midiPanel").slideToggle()
});jQuery(".toggleTimeSignaturePanel").click(function(){jQuery("#timeSignaturePanel").slideToggle()
});$(window).on("keydown",handleKeyPressed)});function handleKeyPressed(a){if(a.which===32){if(myMidiClock.isStarted()){myMidiClockPlayer.stop()
}else{myMidiClockPlayer.continue_()}if(a.stopImmediatePropagation){a.stopImmediatePropagation()
}if(a.stopPropagation){a.stopPropagation()}a.preventDefault()}else{if(a.which===13){if(myMidiClock.isStarted()){myMidiClockPlayer.stop()
}else{myMidiClockPlayer.start()}if(a.stopPropagation){a.stopPropagation()}a.preventDefault()
}else{if(a.which===43){myMidiClockPlayer.setBpm(myMidiClockPlayer.getBpm()+1)}else{if(a.which===45){myMidiClockPlayer.setBpm(myMidiClockPlayer.getBpm()-1)
}else{if(a.which===68){$("#divisionCheckbox").click()}else{if(a.which===73){jQuery("#infoPanel").slideToggle()
}else{if(a.which===77){jQuery("#midiPanel").slideToggle()}else{if(a.which===83){jQuery("#timeSignaturePanel").slideToggle()
}else{if(a.which===84){$("#metronomeCheckbox").click()}}}}}}}}}}jQuery(document).ready(function(){jQuery("#inputLog").click(function(){jQuery(this).html("")
})});function devicesChanged(a){listMidiInputDevices(a.midiAccess);listMidiOutputDevices(a.midiAccess)
}function listMidiInputDevices(a){var b=jQuery("#midiInputs");b.html("");if(a!=null&&a.inputs!=null){a.inputs.forEach(function(c,e){var d="";
d+=""+(c.onmidimessage?"<span class='fa fa-check text-success'></span>":"<span class='fa fa-plug'></span>")+" ";
d+=c.name;b.append(jQuery("<button/>",{inputPortName:c.name,portConnected:c.onmidimessage?1:0,"class":"list-group-item  list-group-item-action"}).append(jQuery("<div/>",{}).html(d)).click(function(){var f=jQuery(this).attr("inputPortName");
if(parseInt(jQuery(this).attr("portConnected"))){myMidiAccessApi.unbindInputPortByName(f)
}else{myMidiAccessApi.bindInputPortByName(f)}}))})}}function listMidiOutputDevices(a){var b=jQuery("#midiOutputs");
b.html("");if(a!=null&&a.outputs!=null){if(typeof a.outputs[Symbol.iterator]==="function"){a.outputs.forEach(function(e,d){var c="";
c+=""+(myMidiAccessApi.isOutputConnectedById(e.id)?"<span class='fa fa-check text-success'></span>":"<span class='fa fa-plug'></span>")+" ";
c+=e.name;c+=" <small>("+e.id+")</small>";b.append(jQuery("<button/>",{"class":"list-group-item list-group-item-action",outputPortName:e.name,portConnected:myMidiAccessApi.isOutputConnectedById(e.id)?1:0}).html(c).click(function(){var f=jQuery(this).attr("outputPortName");
if(parseInt(jQuery(this).attr("portConnected"))){myMidiAccessApi.disconnectOutputPortByName(f)
}else{myMidiAccessApi.connectOutputPortByName(f)}}))})}}}function refreshTimeSignatureInfo(a,b){$("#clockTimeSignature").html(a+"/"+b)
}function refreshNumberOfBarInfo(a){$("#clockNumberOfBars").html(a)}function refreshDivisionInfo(a){$("#clockDivision").html(a)
}function refreshBpmInfo(a){jQuery("#bpmValue").html(a+" BPM")}function logText(a){jQuery("#inputLog").html(a)
}function logMidiInputEventArray(g){var e="";for(var b in g){var a=g[b];var d=0;for(var f in a){var c=a[f];
if((typeof c)=="number"){c=(c+"").padStart(3,"0")}else{c=c.padEnd(14,".")+""}e+=(d>0?", ":"")+f+": "+c;
d++}}jQuery("#inputLog").prepend(e+"<br/>");jQuery("#inputLog").html(jQuery("#inputLog").html().substring(0,2000))
};