/* Copyright (C) Volcanomobile, Inc - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential 
 * Written by Volcanomobile <contact@volcanomobile.net>, January 2020 
 */ 

var jMidiClock=function(b){var c={numerator:4,denominator:4,numberOfBars:2,division:16,patternLenghtInTick:0,barLenghtInTick:0,beatLenghtInTick:0,divisionLenghtInTick:0,started:false,slaveMode:false,startTempo:false,startTempoPlaying:false,patternClockCpt:0,barClockCpt:0,beatClockCpt:0,divisionClockCpt:0,onInit:null,onStartTempo:null,onStart:null,onContinue:null,onStop:null,onStartTempoClock:null,onClock:null,onTimeSignatureChange:null,onNumberOfBarsChange:null,onDivisionChange:null};
var a=this;this.construct=function(d){$.extend(c,d);this.refreshLenghtInTick();if(c.onInit){c.onInit(c)
}};this.refreshLenghtInTick=function(){c.beatLenghtInTick=96/c.denominator;c.barLenghtInTick=c.beatLenghtInTick*c.numerator;
c.patternLenghtInTick=c.barLenghtInTick*c.numberOfBars;c.divisionLenghtInTick=96/c.division
};this.clock=function(){if(c.started){if(c.startTempoPlaying){if(c.onStartTempoClock){c.onStartTempoClock(c)
}c.patternClockCpt=c.patternClockCpt+1;if(c.patternClockCpt==c.barLenghtInTick){c.startTempoPlaying=false;
c.patternClockCpt=0;if(c.onStart){c.onStart()}}}else{if(c.onClock){c.onClock(c)}c.patternClockCpt=(c.patternClockCpt+1)%c.patternLenghtInTick
}c.barClockCpt=c.patternClockCpt%c.barLenghtInTick;c.beatClockCpt=c.barClockCpt%c.beatLenghtInTick;
c.divisionClockCpt=c.barClockCpt%c.divisionLenghtInTick}};this.start=function(d){if(!c.started){c.patternClockCpt=0;
c.barClockCpt=0;c.beatClockCpt=0;c.started=true;c.slaveMode=d;if(c.slaveMode){this.setStartTempo(false)
}if(c.startTempo){c.startTempoPlaying=true;if(c.onStartTempo){c.onStartTempo()}}else{if(c.onStart){c.onStart(d)
}}}};this.continue_=function(){if(!c.started){c.started=true;c.onContinue()}};this.stop=function(){if(c.started){c.started=false;
c.startTempoPlaying=false;if(c.onStop){c.onStop()}}};this.isStarted=function(){return c.started
};this.getDenominator=function(){return c.denominator};this.setDenominator=function(d){c.denominator=d;
this.refreshLenghtInTick();if(c.onTimeSignatureChange){c.onTimeSignatureChange(c.numerator,c.denominator)
}};this.getNumerator=function(){return c.numerator};this.setNumerator=function(d){c.numerator=d;
this.refreshLenghtInTick();if(c.onTimeSignatureChange){c.onTimeSignatureChange(c.numerator,c.denominator)
}};this.getNumberOfBars=function(){return c.numberOfBars};this.setNumberOfBars=function(d){c.numberOfBars=d;
this.refreshLenghtInTick();if(c.onNumberOfBarsChange){c.onNumberOfBarsChange(c.numberOfBars)
}};this.getDivision=function(){return c.division};this.setDivision=function(d){c.division=d;
this.refreshLenghtInTick();if(c.onDivisionChange){c.onDivisionChange(c.division)}};
this.getStartTempo=function(){return c.startTempo};this.setStartTempo=function(d){c.startTempo=d
};this.construct(b)};var jMidiClockPlayer=function(b){var c={loopDelayMilli:9,bpm:60,tickMilli:0,lastTimeMilli:0,delayMilli:0,started:false,slaveMode:false,clockCpt:0,onInit:null,onStart:null,onContinue:null,onStop:null,onClock:null,onBpmChange:null};
var a=this;this.construct=function(d){$.extend(c,d);c.tickMilli=60000/c.bpm/24;if(c.onInit){c.onInit(c)
}};this.start=function(e){if(!c.started){c.clockCpt=0;c.started=true;c.slaveMode=e;
c.onStart(e);var f=new Date();c.lastTimeMilli=f.getTime();if(!c.slaveMode){this.loop()
}}};this.continue_=function(e){if(!c.started){c.started=true;if(c.onContinue){c.onContinue()
}var f=new Date();c.lastTimeMilli=f.getTime();this.loop()}};this.stop=function(d){if(c.started){c.started=false;
c.onStop()}};this.loop=function(){if(c.started){while(c.delayMilli>=0){a.clock(false);
c.clockCpt++;c.delayMilli-=c.tickMilli}var e=new Date();c.delayMilli+=(e.getTime()-c.lastTimeMilli);
c.lastTimeMilli=e.getTime();setTimeout(a.loop,c.loopDelayMilli)}};this.clock=function(d){if(c.onClock){c.onClock(c.clockCpt)
}};this.setBpm=function(d){if(d>=10){c.bpm=d;c.tickMilli=60000/c.bpm/24;if(c.onBpmChange){c.onBpmChange(c.bpm)
}}};this.getBpm=function(){return c.bpm};this.construct(b)};